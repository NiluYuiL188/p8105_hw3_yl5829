---
title: "p8105_hw3_yl5829"
output: github_document
date: "2024-10-12"
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

##Problem 1

```{r}
data("ny_noaa")
```


##Problem 2

```{r}
demo <- read.csv("data/nhanes_covar.csv")
accel <- read.csv("data/nhanes_accel.csv")

#tidy demographic data by renaming columns
demo <- demo %>%
  rename(
    seqn = X,
    sex = X1...male,
    age = X.1,
    BMI = X.2,
    education = X1...Less.than.high.school 
  ) %>%
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
    education = factor(education, levels = c(1, 2, 3), labels = c("Less than High School", "High School", "More than High School"))
  )

accel <- accel %>% rename(seqn = SEQN)

# Merge two data
merged_data <- merge(demo, accel, by = "seqn")

merged_data <- merged_data %>% 
  mutate(age = as.numeric(age)) 

merged_data <- merged_data%>%
  filter(age >= 21) %>%
  filter(!is.na(sex) & !is.na(age) & !is.na(BMI) & !is.na(education)) 

print(merged_data)

```

```{r}
#summary table for the number of men and women in each education category
education_sex_table <- merged_data %>%
  group_by(education, sex) %>%
  summarize(count = n()) %>%
  arrange(education, sex)

print(education_sex_table)

```
By looking at the table we can see that both male and female show higher education level, and there is no large gap between education level of male and female.


```{r}
# Create a line plot for age distribution by education level and sex
ggplot(merged_data, aes(x = age, color = sex, group = sex)) +
  geom_density() +  # Line plot using density for smoother distribution
  facet_wrap(~ education) +
  labs(title = "Age Distribution by Education Level and Sex", 
       x = "Age", 
       y = "Density", 
       color = "Sex") +
  theme_minimal()

```
By looking at the plot we see that there are differences in the ages of participants based on both education level and sex. Female tend to peak at younger ages in each education category, while male age distributions are generally broader.

```{r}
#aggregate total activity
activity <- merged_data %>%
  rowwise() %>%
  mutate(total = sum(c_across(starts_with("min")), na.rm = TRUE)) %>%
  ungroup()

print(activity)

```

```{r}
#plot
ggplot(activity, aes(x = age, y = total, color = sex)) +
  geom_point(alpha = 0.6) +  
  geom_smooth(method = "loess", se = FALSE) +  
  facet_wrap(~ education) +  
  labs(title = "Total Activity vs Age by Education Level and Sex", 
       x = "Age", 
       y = "Total Activity", 
       color = "Sex") +
  theme_minimal()

```




```{r}
demo1 <- read.csv("data/nhanes_covar.csv")

```


```{r}
print(demo1)
print(accel)
```

