---
title: "p8105_hw3_yl5829"
output: github_document
date: "2024-10-12"
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

##Problem 1

```{r}
data("ny_noaa")
```


##Problem 2

```{r}
demo <- read.csv("data/nhanes_covar.csv")
accel <- read.csv("data/nhanes_accel.csv")

#tidy demographic data by renaming columns
demo <- demo %>%
  rename(
    seqn = X,
    sex = X1...male,
    age = X.1,
    BMI = X.2,
    education = X1...Less.than.high.school 
  ) %>%
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
    education = factor(education, levels = c(1, 2, 3), labels = c("Less than High School", "High School", "More than High School"))
  )

accel <- accel %>% rename(seqn = SEQN)

# Merge two data
merged_data <- merge(demo, accel, by = "seqn")

merged_data <- merged_data %>% 
  mutate(age = as.numeric(age)) 

merged_data <- merged_data%>%
  filter(age >= 21) %>%
  filter(!is.na(sex) & !is.na(age) & !is.na(BMI) & !is.na(education)) 

print(merged_data)

```

```{r}
#summary table for the number of men and women in each education category
education_sex_table <- merged_data %>%
  group_by(education, sex) %>%
  summarize(count = n()) %>%
  arrange(education, sex)

print(education_sex_table)

```
By looking at the table we can see that both male and female show higher education level, and there is no large gap between education level of male and female.


```{r}
# Create a line plot for age distribution by education level and sex
ggplot(merged_data, aes(x = age, color = sex, group = sex)) +
  geom_density() +  # Line plot using density for smoother distribution
  facet_wrap(~ education) +
  labs(title = "Age Distribution by Education Level and Sex", 
       x = "Age", 
       y = "Density", 
       color = "Sex") +
  theme_minimal()

```
By looking at the plot we see that there are differences in the ages of participants based on both education level and sex. Female tend to peak at younger ages in each education category, while male age distributions are generally broader.

```{r}
#aggregate total activity
activity <- merged_data %>%
  rowwise() %>%
  mutate(total = sum(c_across(starts_with("min")), na.rm = TRUE)) %>%
  ungroup()

print(activity)

```

```{r}
#plot
ggplot(activity, aes(x = age, y = total, color = sex)) +
  geom_point(alpha = 0.6) +  
  geom_smooth(method = "loess", se = FALSE) +  
  facet_wrap(~ education) +  
  labs(title = "Total Activity vs Age by Education Level and Sex", 
       x = "Age", 
       y = "Total Activity", 
       color = "Sex") +
  theme_minimal()

```

In education level equal or higher than high school, female shows more activity levels than male.
In Less than high school category, both male and female shows a suddenly increase activity level around age 60. However, overall both male and female illustrate a obviously decline trend. This trend is also obvious for more than high school group. 
There is a big upward trending from age 21 to age 40 for high school group, which is significant different compare to any other groups.

```{r}
#make the data from wide to long format for the minute columns
long_activity_data <- merged_data %>%
  pivot_longer(cols = starts_with("min"), names_to = "minute", values_to = "activity") %>%
  mutate(minute = as.numeric(gsub("min", "", minute)))

#plot
ggplot(long_activity_data, aes(x = minute, y = activity, color = sex)) +
  geom_line(alpha = 0.3) +  
  geom_smooth(se = FALSE, method = "loess") +  
  facet_wrap(~ education) +
  labs(title = " 24-hour activity time courses", 
       x = "Minute of the Day", 
       y = "Activity Level", 
       color = "Sex") +
  theme_minimal()

```

By observing the plot we see that activity generally increases in the morning, reach its peaks around midday, and declines in the evening across all education levels. People has "More than High School" education shows higher and more sustained activity throughout the day compared to the other groups. For all education groups, Females consistently show slightly higher activity levels than males, particularly in the middle of the day. In the "Less than High School" group, activity is generally lower, while those in the "High School" and "More than High School" groups maintain more structured and consistent activity patterns. Overall, both education and sex influence the intensity and distribution of physical activity throughout the day.

##Problem3

```{r}
july24 <- read.csv("data/July 2024 Citi.csv")
jan24 <- read.csv("data/Jan 2024 Citi.csv")
july20 <- read.csv("data/July 2020 Citi.csv")
jan20 <- read.csv("data/Jan 2020 Citi.csv")


```

